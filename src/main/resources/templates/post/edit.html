<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head th:replace="~{layout/header :: head}"></head>

<body class="min-h-screen bg-white">
<div th:replace="~{layout/header :: header}"></div>

<main class="create-page">
    <div class="create-container">
        <h2>게시물 수정</h2>

        <!-- ✅ enctype 추가 + id=editForm 유지 -->
        <form th:action="@{/posts/{id}/edit(id=${postId})}"
              method="post"
              enctype="multipart/form-data"
              id="editForm">

            <div class="form-group">
                <label for="title">제목 *</label>
                <input type="text" id="title" name="title" required maxlength="200"
                       placeholder="제목을 입력하세요"
                       th:value="${title}">
            </div>

            <div class="form-group">
                <label for="category">카테고리 *</label>
                <select id="category" name="category" required>
                    <option value="">선택하세요</option>

                    <option th:each="c : ${categories}"
                            th:value="${c.categoryName}"
                            th:text="${c.categoryName}"
                            th:selected="${c.categoryName == category}">
                        카테고리
                    </option>
                </select>
            </div>

            <div class="form-group">
                <label for="description">설명</label>
                <textarea id="description" name="description" rows="6"
                          placeholder="내용을 입력하세요"
                          th:text="${description}"></textarea>
            </div>

            <!-- ✅ (선택) 현재 이미지 영역: 지금 컨트롤러에서 images=List.of() 내려주고 있어서
                 화면 구조만 유지되고, 나중에 실제 이미지 목록 붙이면 자동으로 표시됨 -->
            <div class="form-group">
                <label>현재 이미지</label>
                <div class="current-images">
                    <div class="current-image-item" th:each="img : ${images}">
                        <img th:src="@{${img}}" alt="현재 이미지">
                    </div>
                    <div class="help-text" th:if="${#lists.isEmpty(images)}">현재 등록된 이미지가 없습니다.</div>
                </div>
            </div>

            <!-- ✅ 새 이미지 업로드(교체) -->
            <div class="form-group">
                <label for="newImages">새 이미지 (선택)</label>
                <input type="file"
                       id="newImages"
                       name="newImages"
                       accept="image/*"
                       multiple
                       onchange="previewImages(event)">
                <p class="help-text">새 이미지를 선택하면 기존 이미지가 교체됩니다</p>
            </div>

            <!-- ✅ 새 이미지 미리보기 -->
            <div id="imagePreview" class="image-preview"></div>

            <div class="form-actions">
                <button type="button" onclick="history.back()" class="btn-cancel">취소</button>
                <button type="submit" class="btn-submit">수정 완료</button>
            </div>
        </form>
    </div>
</main>

<script th:src="@{/js/post.js}"></script>
</body>
</html>
